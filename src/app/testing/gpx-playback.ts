export const gpxData = `<?xml version="1.0"?>
<gpx version="1.1" creator="gpxgenerator.com">
<wpt lat="47.50605093518078" lon="7.609623557779939">
    <ele>279.17</ele>
    <time>2023-02-22T12:23:46Z</time>
</wpt>
<wpt lat="47.50610891483806" lon="7.609312421534211">
    <ele>279.93</ele>
    <time>2023-02-22T12:24:15Z</time>
</wpt>
<wpt lat="47.50618574111972" lon="7.609072923660278">
    <ele>278.99</ele>
    <time>2023-02-22T12:24:38Z</time>
</wpt>
<wpt lat="47.50601107412924" lon="7.608926183436067">
    <ele>280.28</ele>
    <time>2023-02-22T12:25:04Z</time>
</wpt>
<wpt lat="47.505862500852345" lon="7.608786708567292">
    <ele>281.05</ele>
    <time>2023-02-22T12:25:27Z</time>
</wpt>
<wpt lat="47.50561970947036" lon="7.608464843485505">
    <ele>282.73</ele>
    <time>2023-02-22T12:26:10Z</time>
</wpt>
<wpt lat="47.505449392457535" lon="7.608035690043122">
    <ele>291.05</ele>
    <time>2023-02-22T12:26:54Z</time>
</wpt>
<wpt lat="47.50523743404915" lon="7.607764835321831">
    <ele>290.59</ele>
    <time>2023-02-22T12:27:31Z</time>
</wpt>
<wpt lat="47.50527367190404" lon="7.607614631616997">
    <ele>291.70</ele>
    <time>2023-02-22T12:27:45Z</time>
</wpt>
<wpt lat="47.50524468162212" lon="7.607507343256401">
    <ele>291.93</ele>
    <time>2023-02-22T12:27:55Z</time>
</wpt>
<wpt lat="47.50513596792232" lon="7.6074483346580735">
    <ele>290.06</ele>
    <time>2023-02-22T12:28:10Z</time>
</wpt>
<wpt lat="47.505012758790365" lon="7.6073732328056565">
    <ele>288.85</ele>
    <time>2023-02-22T12:28:27Z</time>
</wpt>
<wpt lat="47.50454166238375" lon="7.607067460977959">
    <ele>279.92</ele>
    <time>2023-02-22T12:29:35Z</time>
</wpt>
<wpt lat="47.50468977827147" lon="7.607199883638116">
    <ele>279.74</ele>
    <time>2023-02-22T12:29:58Z</time>
</wpt>
<wpt lat="47.504760442802585" lon="7.607317900834771">
    <ele>280.56</ele>
    <time>2023-02-22T12:30:12Z</time>
</wpt>
<wpt lat="47.504757724937775" lon="7.607403731523248">
    <ele>281.78</ele>
    <time>2023-02-22T12:30:19Z</time>
</wpt>
<wpt lat="47.504746853477045" lon="7.607480174480172">
    <ele>282.41</ele>
    <time>2023-02-22T12:30:26Z</time>
</wpt>
<wpt lat="47.504690684227576" lon="7.607419824777337">
    <ele>280.72</ele>
    <time>2023-02-22T12:30:35Z</time>
</wpt>
<wpt lat="47.50461277194333" lon="7.607284373222085">
    <ele>279.80</ele>
    <time>2023-02-22T12:30:51Z</time>
</wpt>
<wpt lat="47.50452489399558" lon="7.6072012247426235">
    <ele>279.05</ele>
    <time>2023-02-22T12:31:04Z</time>
</wpt>
<wpt lat="47.504472348348266" lon="7.607143557248803">
    <ele>278.81</ele>
    <time>2023-02-22T12:31:12Z</time>
</wpt>
<wpt lat="47.50434153726216" lon="7.607044975101278">
    <ele>276.41</ele>
    <time>2023-02-22T12:31:31Z</time>
</wpt>
<wpt lat="47.50420473679969" lon="7.607008765279577">
    <ele>274.36</ele>
    <time>2023-02-22T12:31:49Z</time>
</wpt>
<wpt lat="47.50393293285038" lon="7.606955011609342">
    <ele>275.89</ele>
    <time>2023-02-22T12:32:25Z</time>
</wpt>
<wpt lat="47.50388647062919" lon="7.606961717131879">
    <ele>276.21</ele>
    <time>2023-02-22T12:32:31Z</time>
</wpt>
<wpt lat="47.50386925719635" lon="7.607004632476118">
    <ele>277.28</ele>
    <time>2023-02-22T12:32:35Z</time>
</wpt>
<wpt lat="47.50369259269098" lon="7.607015361312177">
    <ele>280.54</ele>
    <time>2023-02-22T12:32:58Z</time>
</wpt>
<wpt lat="47.503661789588165" lon="7.606904049638059">
    <ele>279.14</ele>
    <time>2023-02-22T12:33:08Z</time>
</wpt>
<wpt lat="47.503647294004104" lon="7.606849064353254">
    <ele>278.46</ele>
    <time>2023-02-22T12:33:13Z</time>
</wpt>
<wpt lat="47.503133873443815" lon="7.6066521227498285">
    <ele>279.90</ele>
    <time>2023-02-22T12:34:23Z</time>
</wpt>
<wpt lat="47.5025975287743" lon="7.606265884651684">
    <ele>280.22</ele>
    <time>2023-02-22T12:35:42Z</time>
</wpt>
<wpt lat="47.50235109830512" lon="7.606330257668041">
    <ele>282.00</ele>
    <time>2023-02-22T12:36:15Z</time>
</wpt>
<wpt lat="47.50212080031385" lon="7.606290457861551">
    <ele>283.99</ele>
    <time>2023-02-22T12:36:45Z</time>
</wpt>
<wpt lat="47.50184356343713" lon="7.60618585170997">
    <ele>284.97</ele>
    <time>2023-02-22T12:37:23Z</time>
</wpt>
<wpt lat="47.50109855982298" lon="7.605930654021309">
    <ele>283.16</ele>
    <time>2023-02-22T12:39:05Z</time>
</wpt>
<wpt lat="47.50034112321555" lon="7.605740217181252">
    <ele>280.14</ele>
    <time>2023-02-22T12:40:47Z</time>
</wpt>
<wpt lat="47.50034837146454" lon="7.605549780341194">
    <ele>279.67</ele>
    <time>2023-02-22T12:41:04Z</time>
</wpt>
<wpt lat="47.50022696316201" lon="7.60540494105439">
    <ele>280.19</ele>
    <time>2023-02-22T12:41:24Z</time>
</wpt>
<wpt lat="47.500114946911374" lon="7.605332521410988">
    <ele>278.90</ele>
    <time>2023-02-22T12:41:40Z</time>
</wpt>
<wpt lat="47.499288636407805" lon="7.6052681483946305">
    <ele>277.58</ele>
    <time>2023-02-22T12:43:30Z</time>
</wpt>
<wpt lat="47.49865218835282" lon="7.605294970484779">
    <ele>278.17</ele>
    <time>2023-02-22T12:44:54Z</time>
</wpt>
<wpt lat="47.49830244789985" lon="7.605190364333199">
    <ele>279.27</ele>
    <time>2023-02-22T12:45:41Z</time>
</wpt>
</gpx>`;

export function playbackGPX(gpxData: string) {
  // Parse the GPX data to extract the track points
  const trackPoints = parseGPX(gpxData);

  // Sort the track points by time
  trackPoints.sort((a, b) => {
    return new Date(a.time).getTime() - new Date(b.time).getTime();
  });

  // Play back the GPS trace
  let currentIndex = 0;
  const playbackTimer = setInterval(() => {
    if (currentIndex < trackPoints.length) {
      // print current position
      console.log(trackPoints[currentIndex]);
      currentIndex++;
    } else {
      // Stop the timer when all track points have been played back
      clearInterval(playbackTimer);
    }
  }, 1000);
}

export function parseGPX(gpxData: string) {
  // Parse XML
  const parser = new DOMParser();
  const xmlDoc = parser.parseFromString(gpxData, 'text/xml');
  const trackPoints = [];

  // Extract the track points from the parsed XML
  const trkpts = xmlDoc.getElementsByTagName('wpt');
  for (let i = 0; i < trkpts.length; i++) {
    const trkpt = trkpts[i];
    const lat = parseFloat(trkpt.getAttribute('lat') ?? '');
    const lon = parseFloat(trkpt.getAttribute('lon') ?? '');
    const ele = parseFloat(trkpt.getElementsByTagName('ele')[0].textContent ?? '');
    const time = new Date(trkpt.getElementsByTagName('time')[0].textContent ?? 0).getTime();
    trackPoints.push({ lat, lon, ele, time });
  }
  return trackPoints;
}
